<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>3. Program execution - Project-47 language documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="custom.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">README</a></li><li class="chapter-item expanded affix "><a href="forewords.html">Forewords</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Fundamental knowledges</li><li class="spacer"></li><li class="chapter-item expanded "><a href="cha1-terms-n-defs.html"><strong aria-hidden="true">1.</strong> Terms and definitions</a></li><li class="chapter-item expanded "><a href="cha2-lex-convs.html"><strong aria-hidden="true">2.</strong> Lexical conventions</a></li><li class="chapter-item expanded "><a href="cha3-prog-exec.html" class="active"><strong aria-hidden="true">3.</strong> Program execution</a></li><li class="chapter-item expanded affix "><li class="part-title">Entities and semantics</li><li class="spacer"></li><li class="chapter-item expanded "><a href="cha4-types.html"><strong aria-hidden="true">4.</strong> Types</a></li><li class="chapter-item expanded "><a href="cha5-id-scope.html"><strong aria-hidden="true">5.</strong> Identifiers and scopes</a></li><li class="chapter-item expanded "><a href="cha6-decls.html"><strong aria-hidden="true">6.</strong> Declarations</a></li><li class="chapter-item expanded "><a href="cha8-exprs.html"><strong aria-hidden="true">7.</strong> Expressions</a></li><li class="chapter-item expanded "><a href="cha9-stmts.html"><strong aria-hidden="true">8.</strong> Statements</a></li><li class="chapter-item expanded "><a href="cha10-attrs.html"><strong aria-hidden="true">9.</strong> Attributes</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="app1-grammar.html">A. Grammar of Pr47</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Project-47 language documentation</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#3---program-execution---pr47exec" id="3---program-execution---pr47exec">3.   Program execution   <code>[pr47.exec]</code></a></h2>
<p><sup>1</sup>   Pr47 is a semi-static programming language, due to which it combines static or compile time checks with dynamic or runtime checks. A Pr47 program is firstly compiled with certain static rules, and then executed with dynamic rules applied.</p>
<h3><a class="header" href="#31---initialization---pr47execinit" id="31---initialization---pr47execinit">3.1   Initialization   <code>[pr47.exec.init]</code></a></h3>
<p><sup>1</sup>   A Pr47 implementation may optionally have one or more initialization stages, which may initialize certain internal data and programs. Initialization, if present, should act like a normal Rust function or method.</p>
<h3><a class="header" href="#32---pr47-foreign-type-registration---pr47execregtype" id="32---pr47-foreign-type-registration---pr47execregtype">3.2   Pr47 foreign type registration   <code>[pr47.exec.reg.type]</code></a></h3>
<p><sup>1</sup>   A Pr47 implementation should provide an interface for registing foreign types, so that foreign functions and scripts can use them. Registing a Rust type mostly involves remembering the <code>std::any::TypeId</code> of that type, and associate it with an identifier in a specific scope.</p>
<p><sup>2</sup>   The implementation must be able to register any <code>T: 'static</code>; The implementation may also optionally implement registration for <code>T: 'a</code>, where <code>'a</code> is the lifetime of Pr47 environment, with certain restrictions and assumptions.</p>
<p><sup>3</sup>   Implementation should allow user to omit the identifier and scope for that registered type. When user choose to omit type name and scope, the implementation should use <code>std::any::type_name</code> to obtain an descriptional name for that type, and register that type to global scope.</p>
<p><sup>4</sup>   Despite in the implementation part, registing a foreign type to <code>std</code> module or its submodule is ill-formed, and should be rejected at registration time.</p>
<h3><a class="header" href="#33---pr47-foreign-function-registration---pr47execregfunc" id="33---pr47-foreign-function-registration---pr47execregfunc">3.3   Pr47 foreign function registration   <code>[pr47.exec.reg.func]</code></a></h3>
<p><sup>1</sup>   A Pr47 implementation should provide an interface for registing foreign functions, so that scripts can use them. Registing a Rust function mostly involves remembering the function signature with assistance of <code>std::any::TypeId</code>, optionally creating a wrapper for that function and associate it with an identifier in a specific scope.</p>
<p><sup>2</sup>   An implementation must be able to register any <code>Fn</code> whose parameter types and return type satisfies <code>T: static</code>. An implementation may also optionally implement registration for <code>Fn</code> whose parameter types and return type satisfies <code>T: 'a</code>, where <code>'a</code> is the lifetime of Pr47 environment, with certain restrictions and assumptions.</p>
<p><sup>3</sup>   By default, a Pr47 implementation should transfer the ownership of argument to Rust host environment when calling a foreign function, take the ownership of return value from Rust host environment when the function returns.</p>
<p><sup>4</sup>   For parameters satisfy <code>T: Copy</code>, a Pr47 implementation should make a copy of the argument.</p>
<p><sup>5</sup>   For parameters with reference type <code>&amp;T</code>, a Pr47 implementation should share the argument immutably between the Pr47 environment and Rust host. For parameters with mutable reference type <code>&amp;mut T</code>, the implementation should share the argument mutably between the Pr47 environment and Rust host. Foreign functions require mutable share are considered unsafe by Pr47.</p>
<p><sup>6</sup>   For parameters with type that satisfies <em>type fusion</em> rules, see <code>[pr47.type.fusion]</code>. </p>
<p><sup>7</sup>   When receiving return values from Rust function, <code>&amp;std::option::Option&lt;T&gt;</code> should be converted to <code>std::option::Option&lt;&amp;T&gt;</code> using <code>std::option::Option::as_ref</code>, and <code>&amp;mut std::option::Option&lt;T&gt;</code> should be converted to <code>std::option::Option&lt;&amp;mut T&gt;</code> using <code>std::option::Option::as_mut</code>.</p>
<h3><a class="header" href="#34---compilation---pr47execcomp" id="34---compilation---pr47execcomp">3.4   Compilation   <code>[pr47.exec.comp]</code></a></h3>
<p><sup>1</sup>   After registing foreign types and functions, the Pr47 implementation should then read in the Pr47 scripts, enforce the static checking rules, and may optionally transform source codes into some optimized form. In a typical Pr47 implementation, the following steps may be taken in order.</p>
<h4><a class="header" href="#341---lexical-analysis---pr47execcomplex" id="341---lexical-analysis---pr47execcomplex">3.4.1   Lexical analysis   <code>[pr47.exec.comp.lex]</code></a></h4>
<h4><a class="header" href="#342---parsing---pr47execcompparse" id="342---parsing---pr47execcompparse">3.4.2   Parsing   <code>[pr47.exec.comp.parse]</code></a></h4>
<h4><a class="header" href="#343---early-compiler-action-application---pr47execcompact1" id="343---early-compiler-action-application---pr47execcompact1">3.4.3   Early compiler action application   <code>[pr47.exec.comp.act1]</code></a></h4>
<h4><a class="header" href="#344---semantics-analysis---pr47execcompsema" id="344---semantics-analysis---pr47execcompsema">3.4.4   Semantics analysis   <code>[pr47.exec.comp.sema]</code></a></h4>
<h4><a class="header" href="#345---late-compiler-action-application---pr47execcompact2" id="345---late-compiler-action-application---pr47execcompact2">3.4.5   Late compiler action application   <code>[pr47.exec.comp.act2]</code></a></h4>
<h4><a class="header" href="#346---transformation-or-code-generation---pr47execcompgen" id="346---transformation-or-code-generation---pr47execcompgen">3.4.6   Transformation or code generation   <code>[pr47.exec.comp.gen]</code></a></h4>
<h3><a class="header" href="#35---function-export---pr47execexport" id="35---function-export---pr47execexport">3.5   Function export   <code>[pr47.exec.export]</code></a></h3>
<p><sup>1</sup>   After compilation, the Pr47 implementation should be able to export functions to host environment. Detailed requirements on such functionality are similar to requirements stated in <code>[pr47.exec.reg.func]</code>.</p>
<h3><a class="header" href="#36---program-execution---pr47execrun" id="36---program-execution---pr47execrun">3.6   Program execution   <code>[pr47.exec.run]</code></a></h3>
<p><sup1>1</sup>   It is possible to launch a single Pr47 function via the exported function interface. It is also possible to treat the whole script as an executable, and start execution from function <code>main</code>, <code>entry</code> or <code>application_start</code>. Only one of <code>main</code>, <code>entry</code> and <code>application_start</code> may be declared to global scope, and must satisfy the following signature:</p>
<pre><code class="language-go">func func_name() int
</code></pre>
<p>  or:</p>
<pre><code class="language-go">func func_name(vector&lt;string&gt;) int
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="cha2-lex-convs.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="cha4-types.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="cha2-lex-convs.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="cha4-types.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
